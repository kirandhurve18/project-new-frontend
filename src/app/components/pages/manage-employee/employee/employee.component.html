<div class="container-fluid my-3">
  <!-- Card 1: Action Buttons -->
  <div class="card shadow-sm border-0 mb-3 bg-white">
    <div class="card-body">
      <div class="d-flex justify-content-between align-items-center flex-wrap">
        <h5 class="fw-bold mb-0">Employee List</h5>
        <div class="d-flex flex-wrap gap-2 ms-auto mt-2 mt-md-0">
          <button
            class="btn fw-semibold px-3 py-2"
            style="background-color: #e5f4f3"
            (click)="goToTeamHierarchy()"
          >
            Team Hierarchy
          </button>
          <button
            class="btn fw-semibold px-3 py-2 text-white"
            style="background-color: #009688"
            (click)="goToRegistration()"
          >
            Add New Employee
          </button>
        </div>
      </div>
    </div>
  </div>

  <!-- Card 2: Filters + Employee Table -->
  <div class="card shadow-sm border-0 bg-white">
    <div class="card-body">
      <!-- Filters -->
      <div class="row mb-3">
        <div class="col-md-6 col-12 d-flex align-items-center mb-2 mb-md-0">
          <label class="me-2 mb-0">Show</label>
          <select
            [(ngModel)]="entriesPerPage"
            (change)="onEntriesPerPageChange()"
            class="form-select form-select-sm w-auto"
          >
            <option [value]="5">5</option>
            <option [value]="10">10</option>
            <option [value]="15">15</option>
            <option [value]="20">20</option>
          </select>
          <span class="ms-2">entries</span>
        </div>

        <div class="col-md-3 col-12">
          <div class="input-group">
            <input
              type="text"
              [(ngModel)]="searchQuery"
              (input)="onSearchChange()"
              class="form-control"
              placeholder="Search Employee"
            />
            <span class="input-group-text bg-white">
              <img src="{{ search_icon }}" width="16" />
            </span>
          </div>
        </div>

        <div class="col-md-3 col-12 mt-2 mt-md-0">
          <div class="input-group">
            <button
              class="form-control d-flex justify-content-between bg-white border"
              (click)="downloadEmployeeList()"
            >
              <span class="text-success">Download List</span>
              <img src="{{ file_excel_solid_1_icon }}" width="24" height="24" />
            </button>
          </div>
        </div>
      </div>

      <!-- Table -->
      <div class="table-responsive">
        <div
          class="row gx-0 text-white fw-bold text-center d-none d-md-flex"
          style="background-color: #009688; height: 50px"
        >
          <div class="col-1">Sr. No.</div>
          <div class="col-2">Name</div>
          <div class="col-2">Company Email</div>
          <div class="col-2">WhatsApp</div>
          <div class="col-1">Designation</div>
          <div class="col-1">Joining Date</div>
          <div class="col-1">RW Agreement</div>
          <div class="col-1">Status</div>
          <div class="col-1">Edit</div>
        </div>

        <div
          *ngFor="let emp of employees; let i = index"
          class="row gx-0 border-bottom py-3 align-items-center text-start text-md-center"
          [ngStyle]="{
            'background-color': i % 2 === 1 ? '#E5F4F3' : 'transparent'
          }"
        >
          <div class="col-12 col-md-1">
            {{ (currentPage - 1) * entriesPerPage + i + 1 }}
          </div>
          <div class="col-12 col-md-2">{{ emp.full_name }}</div>
          <div class="col-12 col-md-2">{{ emp.company_email }}</div>
          <div class="col-12 col-md-2">{{ emp.employee_number }}</div>
          <div class="col-12 col-md-1">{{ emp.designation_name }}</div>
          <div class="col-12 col-md-1">{{ emp.date_of_joining }}</div>
          <div class="col-12 col-md-1">
            {{ emp.rw_agreement_accepted ? "Accepted" : "Not Accepted" }}
          </div>
          <div class="col-12 col-md-1">
            <span
              class="fw-bold"
              [ngClass]="{
                'text-success': emp.is_active,
                'text-danger': !emp.is_active
              }"
              style="cursor: pointer"
              (click)="openStatusModal(emp)"
            >
              {{ emp.is_active ? "Active" : "Inactive" }}
            </span>
          </div>
          <div class="col-12 col-md-1">
            <i
              class="bi bi-pencil-fill text-dark"
              style="cursor: pointer"
              (click)="goToUpdateInfo(emp)"
            ></i>
          </div>
        </div>
      </div>

      <!-- Entries Count -->
      <div class="text-muted mt-3">
        Showing {{ (currentPage - 1) * entriesPerPage + 1 }} to
        {{ (currentPage - 1) * entriesPerPage + employees.length }} of
        {{ totalEmployees }} entries
      </div>

      <!-- Pagination Controls -->
      <nav class="mt-3" *ngIf="totalPages > 1">
        <ul class="pagination pagination-sm justify-content-end mb-0">
          <!-- Previous Button -->
          <li class="page-item" [class.disabled]="currentPage === 1">
            <a class="page-link" (click)="prevPage()">Previous</a>
          </li>

          <!-- Page Numbers -->
          <li
            class="page-item"
            *ngFor="let page of pages"
            [class.active]="page === currentPage"
          >
            <a class="page-link" (click)="changePage(page)">{{ page }}</a>
          </li>

          <!-- Next Button -->
          <li class="page-item" [class.disabled]="currentPage === totalPages">
            <a class="page-link" (click)="nextPage()">Next</a>
          </li>
        </ul>
      </nav>
    </div>
  </div>
</div>

<!-- ✅ Status Modal -->
<div
  class="modal fade show d-block"
  *ngIf="showModal"
  tabindex="-1"
  role="dialog"
  style="background-color: rgba(0, 0, 0, 0.5)"
>
  <div
    class="modal-dialog modal-dialog-centered"
    role="document"
    style="max-width: 540px"
  >
    <div class="modal-content">
      <div
        class="modal-header text-white"
        style="background-color: #009688; height: 75px"
      >
        <h5 class="modal-title m-0 d-flex align-items-center">
          {{
            selectedEmployee?.is_active
              ? "Mark Employee as Inactive ?"
              : "Activate Employee ?"
          }}
        </h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          (click)="closeModal()"
          aria-label="Close"
        ></button>
      </div>
      <div class="modal-body">
        <p class="mb-1">
          Are you sure you want to
          {{ selectedEmployee?.is_active ? "inactivate" : "activate" }}
          {{ selectedEmployee?.first_name }} {{ selectedEmployee?.last_name }}?
        </p>
        <p class="text-muted small mb-0">
          This will
          {{
            selectedEmployee?.is_active
              ? "restrict their system access until reactivated."
              : "restore their system access and privileges."
          }}
        </p>
      </div>
      <div class="modal-footer justify-content-end py-2 px-3">
        <button class="btn btn-sm btn-secondary me-2" (click)="closeModal()">
          Cancel
        </button>
        <button
          class="btn btn-sm text-white"
          [ngClass]="selectedEmployee?.is_active ? 'btn-danger' : 'btn-success'"
          (click)="confirmToggleStatus()"
        >
          Yes, {{ selectedEmployee?.is_active ? "Inactivate" : "Activate" }}
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ✅ Bulk Import Modal -->
<div
  class="modal fade show d-block"
  *ngIf="showBulkImportModal && !showImportResultModal"
  tabindex="-1"
  role="dialog"
  style="background-color: rgba(0, 0, 0, 0.5)"
>
  <div
    class="modal-dialog modal-dialog-centered"
    role="document"
    style="max-width: 540px"
  >
    <div class="modal-content">
      <div
        class="modal-header text-white"
        style="background-color: #009688; height: 75px"
      >
        <h5 class="modal-title">Bulk Import Employee Info</h5>
        <img
          src=""
          alt="Close"
          (click)="closeBulkImportModal()"
          style="cursor: pointer; width: 24px; height: 24px"
        />
      </div>
      <div class="modal-body">
        <p><strong>Download Sample :</strong></p>
        <a
          href="/assets/sample-employee-import.xlsx"
          target="_blank"
          class="text-decoration-underline text-success"
        >
          Download Sample File for Employee Import
        </a>
      </div>
      <div class="modal-footer justify-content-end">
        <button class="btn btn-secondary" (click)="closeBulkImportModal()">
          Cancel
        </button>
        <button
          class="btn text-white"
          style="background-color: #009688"
          (click)="processImport()"
        >
          Choose File to Import
        </button>
      </div>
    </div>
  </div>
</div>

<!-- ✅ Bulk Import Step 2 Result Modal -->
<div
  class="modal fade show d-block"
  *ngIf="showImportResultModal"
  tabindex="-1"
  role="dialog"
  style="background-color: rgba(0, 0, 0, 0.5)"
>
  <div
    class="modal-dialog modal-dialog-centered"
    role="document"
    style="max-width: 540px"
  >
    <div class="modal-content">
      <div
        class="modal-header text-white"
        style="background-color: #009688; height: 75px"
      >
        <h5 class="modal-title">Bulk Import Employee Info</h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          (click)="closeImportResultModal()"
        ></button>
      </div>
      <div class="modal-body">
        <p class="mb-2">
          <strong>We have processed your file. Here's the result:</strong>
        </p>
        <p class="text-success fw-semibold">
          ✔️ Successfully Imported : {{ importSummary.successCount }} Employees
        </p>
        <p class="text-danger fw-semibold">
          ❌ Errors Detected : {{ importSummary.errorCount }} Employees
        </p>

        <hr />
        <p class="text-danger fw-bold">Errors Details :</p>
        <table class="table table-bordered table-sm">
          <thead class="text-white" style="background-color: #00796b">
            <tr>
              <th>Employee Name</th>
              <th>Error Description</th>
            </tr>
          </thead>
          <tbody>
            <tr
              *ngFor="let err of importSummary.errors; let i = index"
              [ngClass]="{ 'bg-light': i % 2 === 1 }"
            >
              <td>{{ err.name }}</td>
              <td>{{ err.description }}</td>
            </tr>
          </tbody>
        </table>
      </div>
      <div class="modal-footer justify-content-end">
        <button class="btn btn-secondary" (click)="closeImportResultModal()">
          Cancel
        </button>
        <button
          class="btn text-white"
          style="background-color: #009688"
          (click)="restartBulkImport()"
        >
          Choose File to Import
        </button>
      </div>
    </div>
  </div>
</div>
